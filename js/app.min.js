mapchart=function(){function a(){$("#map>path").click(function(a){n($(a.target))}),$("#map>path").mouseover(function(a){q(a.target.id)}),$("#map>path").mouseout(function(a){r(a.target.id)}),$("#convert").click(function(){M()}),$("#download").click(function(){w(this,"canvas1")}),$("#download, #undo-clear").toggle(),$("#edit").click(function(){s()}),$("#clear").click(function(){t()}),$("#undo-clear").click(function(){G(JSON.parse(_)),$("#undo-clear").toggle("slow")}),$("#disableLegend").click(function(){v(this)}),$("#upload").click(function(){F()}),$("#isolateState").click(function(){isolateState($("#stateToIsolate").val())}),$("#restoreAllStates").click(function(){restoreAllStates()}),$("#startZoom").click(function(){J()}),$("#exitZoom").click(function(){K()}),$("#resetZoom").click(function(){L()}),$("#legendplace").sortable(),$("#link").click(function(){let a=E();this.href="data:text/plain;charset=utf-8,"+encodeURIComponent(a);let b="mapchartSave__"+S+"__"+$("#mapTitleInput").val().substring(0,32);this.download=b.replace(/[^\w]/gi,"_")+".txt"}),R.includes("wamp")||window.addEventListener("beforeunload",function(a){if(Q()){return(a||window.event).returnValue="It looks like you have been editing something. If you leave before saving, your changes will be lost.","It looks like you have been editing something. If you leave before saving, your changes will be lost."}}),$("#no-borders").change(function(){this.checked?$("#map>path").each(function(){u(this.id)&&$(this).css("stroke",$("#borderpicker").val())}):$("#map>path").each(function(){u(this.id)&&$(this).css("stroke",$(this).css("fill"))})}),$("#show-states").change(function(){this.checked?$("#state_abbr, #state_lines").show():$("#state_abbr, #state_lines").hide()}),$("#isolateFromList").click(function(){$("#isolate-alert").html("");let a=$("#listToIsolate").val().toUpperCase().split(",");a=$.map(a,$.trim);let b=[];$("#map>path").each(function(){let a=this.id.slice(-2);-1===b.indexOf(a)&&b.push(a)});let c="";for(let d=0,e=a.length;d<e;d++)-1===b.indexOf(a[d])&&(c+=a[d]+", ");0<c.length?(c=c.slice(0,-2),$("#isolate-alert").append("<p><em>"+c+"</em> are not valid. Please input valid, comma-separated values.").show()):($("#map>path").each(function(){let b=this.id.slice(-2);-1===a.indexOf(b)&&$(this).hide()}),$("#isolateFromList").prop("disabled",!0).css("color","#fff"),$("#showAll").prop("disabled",!1).css("color","#fff"),$("#isolate-alert").hide())}),$("#showAll").click(function(){$("#map>path").each(function(){$(this).show()}),$("#isolateFromList").prop("disabled",!1).css("color","#fff"),$("#showAll").prop("disabled",!0).css("color","#fff"),$("#isolate-alert").hide()}),$("#colorFromList").click(function(){$("#colorFromList-alert").html("");let a=$("#listToColor").val().toUpperCase().split(",");a=$.map(a,$.trim);let b=[];$("#map>path").each(function(){let a=this.id.slice(-2);-1===b.indexOf(a)&&b.push(a)});let c="";for(let d=0,e=a.length;d<e;d++)-1===b.indexOf(a[d])&&(c+=a[d]+", ");if(0<c.length)c=c.slice(0,-2),$("#colorFromList-alert").append("<p><em>"+c+"</em> are not valid. Please input valid, comma-separated values.").show();else{for(const b of a)addCountryColor(b);$("#colorFromList-alert").hide()}}),conf.originalSVGH=parseInt($("#map").attr("height").match(/\d+/)[0]),$("#mapTitleInput").keydown(function(a){13==a.which&&a.preventDefault()}),$.browser.msie&&(-1===Z.indexOf(S)?$("#img-title").append("<p><span class=\"label label-danger\"><i class=\"fa fa-bullhorn\"></i> Internet Explorer/Edge not supported. Please use another browser. </span></p>"):$("#colorPickers").prepend("<p><span class=\"label label-danger\"><i class=\"fa fa-bullhorn\"></i> Internet Explorer/Edge not supported. Please use another browser. </span></p>")),$("#fillpicker").spectrum({color:"#cc3333",showInput:!0,showPalette:!0,palette:da,showPaletteOnly:!0,togglePaletteOnly:!0,hideAfterPaletteSelect:!0,preferredFormat:"hex",maxSelectionSize:18,containerClassName:"fillpicker-container",show:function(){for(let a in U)$(".fillpicker-container .sp-palette-container span.sp-thumb-el[title=\""+a+"\"]").addClass("sp-thumb-active")}}),$("#fillpicker-form .sp-replacer .sp-preview").css("width",conf.fillBoxWidth),$("#backgroundpicker").spectrum({color:"#fff",showInput:!0,showPalette:!0,palette:da,showPaletteOnly:!0,togglePaletteOnly:!0,hideAfterPaletteSelect:!0,showAlpha:!0,preferredFormat:"hex",change:function(a){$("#map").css("background-color",a)}}),$("#borderpicker").spectrum({color:"#000",showInput:!0,showPalette:!0,palette:da,showPaletteOnly:!0,togglePaletteOnly:!0,hideAfterPaletteSelect:!0,preferredFormat:"hex",change:function(a){$("#map>path").each(function(){u(this.id)&&$(this).css("stroke",a)})}}),$(".btn-new").mouseover(function(){$(this).css("color",$(this).css("background-color"))}).mouseout(function(){$(this).css("color","white")});const a=$(".navbar").height()+2;$(window).scroll(function(){let b=$(document).scrollTop();0<b?$("#info").css("top",0):$("#info").css("top",a+"px")}),$("#isolate-alert, #colorFromList-alert").hide(),$("#isolate-alert, #colorFromList-alert").on("closed.bs.alert",function(){$(this).html("")}),$.contextMenu({selector:"#map>path",className:"data-title",events:{show:function(a){$("#context-menu-layer").remove(),$(".data-title").attr("data-menutitle",a.$trigger.attr("id").replace(/_/g," ")),$("#bgPatternPicker").spectrum({color:f(a.$trigger.attr("id")).bg,showInput:!0,showPalette:!0,palette:da,showPaletteOnly:!0,togglePaletteOnly:!0,hideAfterPaletteSelect:!0,preferredFormat:"hex",maxSelectionSize:18,containerClassName:"botPatternPicker-container",change:function(){i()},show:function(){for(let a in U)$(".botPatternPicker-container .sp-palette-container span.sp-thumb-el[title=\""+a+"\"]").addClass("sp-thumb-active")}}),$("#topPatternPicker").spectrum({color:f(a.$trigger.attr("id")).top,showInput:!0,showPalette:!0,palette:da,showPaletteOnly:!0,togglePaletteOnly:!0,hideAfterPaletteSelect:!0,preferredFormat:"hex",maxSelectionSize:18,containerClassName:"topPatternPicker-container",change:function(){i()},show:function(){for(let a in U)$(".topPatternPicker-container .sp-palette-container span.sp-thumb-el[title=\""+a+"\"]").addClass("sp-thumb-active")}});let b=f(a.$trigger.attr("id")).pType;$(".selectedPattern select").val(b),a.inputs.patternSelect.selected=b,i(),h(a.$trigger)}},items:{removeColor:{name:"Remove Color",icon:"fa-eraser",callback:function(){y(this)},disabled:function(a,b){let c=b.$trigger.attr("id"),e=b.$trigger.attr("fill");if(-1!==V.indexOf(c)||!u(c)||d(e)||e===Y)return!0}},sep1:"---------",addPattern:{name:"Add/Modify Pattern",icon:"fa-th",className:"pattern-holder",items:{bgColor:{name:"                    ",type:"html",className:"",html:"<span>Background Color: </span> <input id='bgPatternPicker' type='text' class='form-control' />"},patternColor:{name:"                    ",type:"html",className:"",html:"<span>Pattern Color: </span> <input id='topPatternPicker' type='text' class='form-control' />"},patternSelect:{name:"Pattern Type: ",type:"select",className:"selectedPattern",selected:"circles3",options:{circles3:"Dots",diagonal1:"Diagonal Stripes Light",diagonal3:"Diagonal Stripes Thick",vertical1:"Vertical Stripes Light",vertical3:"Vertical Stripes Thick",horizontal1:"Horizontal Stripes Light",horizontal3:"Horizontal Stripes Thick",crosshatch:"Crosshatch",texture:"Texture",subtlepatch:"Subtle Patch",checkers:"Checkers",raindrops:"Raindrops"},events:{change:function(){i()}}},sep4:"---------",preview:{name:"",type:"html",className:"preview-pattern",html:"<svg height=\"30\" version=\"1.1\" width=\"100\" xmlns=\"http://www.w3.org/2000/svg\" style=\"overflow: hidden;\" id=\"previewPatternSVG\"><defs></defs><rect class=\"previewPatternRect\" height=\"30\" width=\"100\"></rect> </svg>"},sep5:"---------",confirmPattern:{name:"Paint with Pattern",className:"pattern-button",callback:function(){let a=$(".selectedPattern select").val(),b=$("#bgPatternPicker").spectrum("get").toString(),c=$("#topPatternPicker").spectrum("get").toString();k(this,a,b,c)}}},disabled:function(a,b){let c=b.$trigger.attr("id");if(-1!==V.indexOf(c)||!u(c))return!0}},copyPattern:{name:"Copy Existing Pattern",icon:"fa-clone",className:"existing-patterns-menu",items:{existingPatterns:{name:"                    ",type:"html",html:"",className:"existing-patterns"}},disabled:function(a,b){let c=b.$trigger.attr("id");if(-1!==V.indexOf(c)||!u(c)||0===$("#legendplace>tr>td>div[data-patternId]").length)return!0}},removePattern:{name:"Remove Pattern",icon:"fa-square",callback:function(){z(this)},disabled:function(a,b){let c=b.$trigger.attr("id"),e=b.$trigger.attr("fill");if(-1!==V.indexOf(c)||!u(c)||!d(e))return!0}},sep2:"---------",showPath:{name:"Show",icon:"fa-eye",callback:function(){o(this)},disabled:function(a,b){let c=b.$trigger.attr("id");if(-1==V.indexOf(c)||!u(c))return!0}},hidePath:{name:"Hide",icon:"fa-eye-slash",callback:function(){p(this)},disabled:function(a,b){let c=b.$trigger.attr("id");if(-1!==V.indexOf(c)||!u(c))return!0}},sep3:"---------",info:{name:"*Hidden elements will not appear on the final map.",className:"context-info",disabled:!0}}});for(let a,b=0,c=ea.length;b<c;b++)a=$.parseHTML("<svg>"+ea[b]+"</svg>")[0].firstChild,$("#map defs").append(a)}function b(a,b,c){return a+"_"+b.replace("#","")+"_"+c.replace("#","")}function c(a){return"url(#"+a+")"}function d(a){return-1!==a.indexOf("url")}function e(a){let b=a.split("_");return{pType:b[0],bg:"#"+b[1],top:"#"+b[2]}}function f(a){let b=$("#"+a).attr("fill");if(d(b)){let a=b.match(/\(#([^)]+)\)/)[1].split("_");return{pType:a[0],bg:"#"+a[1],top:"#"+a[2]}}return b=H(b),{pType:"circles3",bg:b,top:"#000000"}}function g(a){let b=$("#"+a).attr("fill");return d(b)?b.match(/\(#([^)]+)\)/)[1]:H(b)}function h(a){let b=$("#legendplace>tr>td>div[data-patternId]").clone(),c=[];for(let d=0,f=b.length;d<f;d++){let f=$(b[d]),g=f.prop("id").replace("box","usedPatternBox");f.prop({id:g}).addClass("used-pattern-box"),f.on("click",function(){let b=e($(this).attr("data-patternId"));l(a,b.pType,b.bg,b.top),$(a).contextMenu("hide")}),c.push(f)}$(".existing-patterns").html(c)}function i(a,d,e){a=a||$(".selectedPattern select").val(),d=d||$("#bgPatternPicker").spectrum("get").toString(),e=e||$("#topPatternPicker").spectrum("get").toString();let f=b(a,d,e),g=$("#"+a).clone().prop({id:f});g.children()[0].setAttribute("fill",d),-1===["diagonal1","diagonal3","crosshatch"].indexOf(a)?g.children()[1].setAttribute("fill",e):g.children()[1].setAttribute("stroke",e),$("#previewPatternSVG defs").append(g),$("#previewPatternSVG .previewPatternRect").attr("fill",c(f))}function j(a){let b=$("#"+a),c=b.html().replace(/\s\s+/g," "),d=b.attr("width"),e=b.attr("height"),f=btoa("<svg xmlns=\"http://www.w3.org/2000/svg\" width=\""+d+"\" height=\""+e+"\">"+c+"</svg>");return"url(\"data:image/svg+xml;base64,"+f+"\")"}function k(a,c,d,e){$("#undo-clear").hide("slow");let f=a[0].id;if(!u(f))return;let h=g(f),i=$(".previewPatternRect").attr("fill"),k=b(c,d,e),l=$("#"+k).clone();$("#map defs").append(l),ea.push(l.outerHTML()),a.attr("fill",i).css("fill",i);let m=j(k);if(!(k in U)){$("#legendplace").append("<tr><td> <div data-patternId=\""+k+"\" class=\"legend-box\" id=\"box"+W+"\"> </div> </td><td> <input type=\"text\" class=\"form-control\" tabindex="+W+1+" id=\"label"+W+"\" style=\"height:20px; width:100%;\"> </input> </td><td style=\"text-align:center\"> <button  class=\"btn btn-new btn-newC btn-xs\" type=\"button\" onclick=\"mapchart.deleteRow(this)\" ><i class=\"fa fa-times\"></i></button></td></tr>");$("#legendplace>tr:last-child>td:first-child>div").css({"background-image":m,"background-repeat":"repeat"}),U[k]={count:1,div:"#box"+W,paths:[f]},W++}else U[k].count++,U[k].paths.push(f);A(h,f)}function l(a,d,e,f){let h=a[0].id,i=g(h),j=b(d,e,f),k=c(j);a.attr("fill",k).css("fill",k),U[j].count++,U[j].paths.push(h),A(i,h)}function m(a,b){if(!(a in U)){$("#legendplace").append("<tr><td> <div class=\"legend-box\" id=\"box"+W+"\" title=\"Click to change the color of this group.\"> </div> </td><td> <input type=\"text\" class=\"form-control\" tabindex="+W+1+" id=\"label"+W+"\" style=\"height:20px; width:100%;\"> </input> </td><td style=\"text-align:center\"> <button  class=\"btn btn-new btn-newC btn-xs\" type=\"button\" onclick=\"mapchart.deleteRow(this)\" ><i class=\"fa fa-times\"></i></button></td></tr>");$("#legendplace>tr:last-child>td:first-child>div").css({"background-color":a}),U[a]={count:1,div:"#box"+W,paths:[b]},$("#box"+W).spectrum({color:a,showInput:!0,showPalette:!0,palette:da,showPaletteOnly:!0,togglePaletteOnly:!0,hideAfterPaletteSelect:!0,containerClassName:"box"+W+"-container",maxSelectionSize:18,preferredFormat:"hex",change:function(a){let b=$(this).css("background-color"),c=H(b),d=a;$(this).css("background-color",d),$("#fillpicker").spectrum("set",d),U[c].paths.forEach(function(a){$("#"+a).attr("fill",d).css("fill",d)}),U[d]={count:U[c].count,div:"#"+$(this).attr("id"),paths:U[c].paths},delete U[c]},show:function(){for(let a in U)$("."+this.id+"-container .sp-palette-container span.sp-thumb-el[title=\""+a+"\"]").addClass("sp-thumb-active")}}),W++}else U[a].count++,U[a].paths.push(b)}function n(a){$("#undo-clear").hide("slow");let b=a[0].id;if(!u(b))return;let c=a[0].style;if(d(c.fill)){let a=$("#info").css("background-color");return $("#info").html("Please Right-click -> Remove Pattern first.").css("background-color","#ff2000"),void setTimeout(function(){$("#info").css("background-color",a)},1e3)}-1!==V.indexOf(b)&&(c.strokeDasharray="none",V.splice(V.indexOf(b),1));let e=""===c.fill?Y:H(c.fill),f=$("#fillpicker").spectrum("get");a.attr("fill",f).css("fill",f),$("#no-borders").is(":checked")||(c.stroke=f),m(f,b),A(e,b)}function o(a){let b=a[0].style,c=a[0].id;a.attr("fill",Y).css("fill",Y),b.strokeDasharray="none",V.splice(V.indexOf(c),1)}function p(a){let b=a[0].style,c=a[0].id,d=g(c);a.attr("fill","#ffffff").css("fill","#ffffff"),b.strokeDasharray="1, 5",V.push(c),A(d,c)}function q(a){if(u(a)){let b=document.getElementById(a);b.setAttribute("stroke-width",conf.mouseoverStroke),$("#info").html($(b).attr("id").replace(/_/g," "))}}function r(a){if(u(a)){let b=document.getElementById(a);b.setAttribute("stroke-width",conf.mouseoutStroke),$("#info").html("-")}}function s(){N(),$("#canvas1").hide(),$("#map").show(),$("#info").show();let a=document.getElementById("canvas1"),b=a.getContext("2d");b.clearRect(0,0,a.width,a.height),B(),$("#edit").prop("disabled",!0),$("#edit").css("color","white"),$("#convert, #clear, #downup").prop("disabled",!1),$("#download").toggle("slow")}function t(){_=E(),$("#map>path").each(function(){u(this.id)&&$(this).attr("fill",Y).css({fill:"#d1dbdd",stroke:"rgb(0,0,0)","stroke-dasharray":"none"})});let a=document.getElementById("canvas1"),b=a.getContext("2d");b.clearRect(0,0,a.width,a.height),B(),$("#ltable").html("<thead><tr><th>Color</th> <th id=\"description\"> Label</th> <th> Remove </th> </tr></thead><tbody id=\"legendplace\"></tbody>"),X||$("#ltable").css("opacity",.3),$("#legendplace").sortable(),$("#map").css("background-color","white"),$("#edit").prop("disabled",!0),$("#convert, #clear, #downup").prop("disabled",!1),$("#undo-clear").toggle("slow"),U={},V=[],W=0}function u(a){let b=!0;return-1!==["State_borders","sidemap","sidemap2","fas_name","state_abbr","state_lines","terr_name","Department_Names","Department_Numbers","Prefecture_Names","Cities","split_UK_label","United_Kingdom_label"].indexOf(a)&&(b=!1),b}function v(a){X?($("#ltable").css("opacity",.3),$(a).removeClass("btn-newC icon-close").addClass("btn-newA icon-enable").html("ENABLE"),X=!1):($("#ltable").css("opacity",1),$(a).removeClass("btn-newA icon-enable").addClass("btn-newC icon-close").html("DISABLE"),X=!0)}function w(a){const b=document.getElementById("canvas1").toDataURL("image/png"),c=x(b),d=URL.createObjectURL(c);a.download=$("#mapTitleInput").val(),a.href=d,/iP(hone|od|ad)/.test(navigator.platform)&&(a.href=b)}function x(a){let b=a.split(","),c=b[0].match(/:(.*?);/)[1],d=atob(b[1]),e=d.length,f=new Uint8Array(e);for(;e--;)f[e]=d.charCodeAt(e);return new Blob([f],{type:c})}function y(a){let b=a[0].style,c=a[0].id;if(""===b.fill)return!1;let d=H(b.fill);d!==Y&&(b.fill=Y,a.attr("fill",Y),!$("#no-borders").is(":checked")&&(b.stroke=Y),A(d,c))}function z(a){let b=a[0].style,c=a[0].id;if(""===b.fill)return!1;let d=g(c),f=e(d);a.attr("fill",f.bg).css("fill",f.bg),m(f.bg,c),A(d,c)}function A(a,b){if(a in U){U[a].count--;let c=U[a].paths.indexOf(b);U[a].paths.splice(c,1),0===U[a].count&&D(a)}}function B(){let a=parseInt($("#canvas1").attr("height")),b=parseInt($("#map").attr("height").match(/\d+/)[0]),c=conf.originalSVGH*(a/b);$("#canvas1").attr("height",c),$("#map").attr("height",conf.originalSVGH)}function C(a){let b=$(a).closest("tr").find("div"),c=b.attr("data-patternId")||H(b.css("background-color"));U[c].paths.forEach(function(a){$("#"+a).attr("fill",Y).css("fill",Y)}),D(c)}function D(a){let b=U[a].div;$(b).parent().parent().remove(),delete U[a]}function E(){let a={groups:{},title:$("#mapTitleInput").val(),hidden:V,background:$("#backgroundpicker").spectrum("get").toString(),borders:$("#borderpicker").spectrum("get").toString()};for(let b in U){let c=U[b].div,d=c.match(/\d/g);d=d.join(""),a.groups[b]={div:c,label:$("#label"+d).val(),paths:U[b].paths}}return JSON.stringify(a)}function F(){t(),$("#undo-clear").hide();let a=JSON.parse($("#uploadData").val());G(a),$("#undo-clear").show(),$("#uploadModal").hide()}function G(a){$("#mapTitleInput").val(a.title),$("#map>path").each(function(){u(this.id)&&$(this).css("stroke",a.borders)}),$("#borderpicker").spectrum("set",a.borders),a.background&&($("#map").css("background-color",a.background),$("#backgroundpicker").spectrum("set",a.background));let b=0;for(let c in a.groups){let d=a.groups[c].paths,f=d.length;for(let a,b=0;b<f;b++)if(a=d[b],ca[a]&&(a=ca[a]),u(a))if(7!==c.length){let b=e(c);i(b.pType,b.bg,b.top),k($("#"+a),b.pType,b.bg,b.top)}else $("#"+a).attr("fill",c).css("fill",c),m(c,a);$("#label"+b).val(a.groups[c].label),b++}if(a.hidden){let b=a.hidden;for(let a=0,c=b.length;a<c;a++)p($("#"+b[a]))}}function H(a){function b(a){return("0"+parseInt(a).toString(16)).slice(-2)}return /^#[0-9A-F]{6}$/i.test(a)?a:(a=a.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),"#"+b(a[1])+b(a[2])+b(a[3]))}function I(){return Object.keys(U).length}function J(){$("#showSvgControls, #svgControls").toggle(),$("#mapContainer").css("border","1px dashed #f78f1e"),zoomTool=new $.SvgZoomer($("#map"))}function K(){$("#showSvgControls, #svgControls").toggle(),$("#mapContainer").css("border",""),zoomTool.stop()}function L(){$("#showSvgControls, #svgControls").toggle(),$("#mapContainer").css("border",""),zoomTool.reset()}function M(){0==$(".loader-map").length&&$("#mapContainer").prepend($("<div class=\"loader-map\"></div>")),$(".loader-map").show(),N();let a=.5<$("#backgroundpicker").spectrum("get").toHsl().l?"#000":"#fff",b=self.URL||self.webkitURL||self,d=$("#canvas1").attr("height")-conf.img2y,e=new Image,f=new Image,g=new Image,h=300;if(X){let e=50+5*conf.legendFactor,g=55+5*conf.legendFactor,i=26+3*conf.legendFactor,j=61+5*conf.legendFactor,k=0,l=0,m=90+5*conf.legendFactor,n=20+5*conf.legendFactor,o="",p=$("#mapTitleInput").val().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),q="<text x=\"30\" y=\"90\" fill=\""+a+"\" font-size=\""+g+"\" font-weight=\"bold\" overflow=\"hidden\" font-family=\"Century Gothic,Segoe UI,Lucida Grande,sans-serif\">",r=0,s=O(p,i+1);if(null===s)q+="<tspan x=\"30\" dy=\"0\"> </tspan>",k+=1;else for(let a=0;a<s.length;a++)q+="<tspan x=\"30\" dy=\""+r+"\">"+s[a]+"</tspan>",r=m-n,k+=1,l+=1;q+="</text>",o+=q;let t="",u=0;for(let b=1;b<=I();b++){let d=$("#ltable tr:eq("+b+") > td:eq(0) > div:eq(0)"),f=d.attr("data-patternId")?c(d.attr("data-patternId")):H(d.css("background-color")),g=80+k*m-l*n,h=$("#ltable tr:eq("+b+") > td:eq(1) input").val().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");u=45+5*conf.legendFactor+g;let o="<text x=\"120\" y=\""+u+"\" fill=\""+a+"\" font-size=\""+e+"\" overflow=\"hidden\" font-family=\"Century Gothic,Segoe UI,Lucida Grande,sans-serif\">";if(r=0,s=O(h,i),null===s)o+="<tspan x=\"120\" dy=\"0\"> </tspan>",k+=1;else for(let a=0;a<s.length;a++)o+="<tspan x=\"120\" dy=\""+r+"\">"+s[a]+"</tspan>",r=m-n,k+=1,0!=a&&(l+=1);o+="</text>",t+="<rect style=\"fill:"+f+";opacity:1;color:#000000;fill-opacity:1;stroke:#000000;stroke-width:1;stroke-opacity:1;\" width=\""+j+"\" height=\""+j+"\" x=\"10\" y=\""+g+"\" />",t+=o}if(h+=u-d,0<h){let a=parseInt($("#canvas1").attr("height")),b=parseInt($("#map").attr("height").match(/\d+/)[0]),c=h/(a/b);$("#canvas1").attr("height",a+h),$("#map").attr("height",b+c)}else h=0;let v=ea.map(function(a){return a.replace("userSpaceOnUse","userSpaceOnUse\" patternTransform=\"scale(2)")}),w="<svg xmlns=\"http://www.w3.org/2000/svg\" width=\""+conf.svgWidth+"\" height=\"5000px\" ><defs>"+v.join("")+"</defs>"+o+t+"</svg>";if(aa)f.src="data:image/svg+xml,"+w;else{let a=new Blob([w],{type:"image/svg+xml;charset=utf-8"}),c=b.createObjectURL(a);f.src=c}}let i=new XMLSerializer().serializeToString(document.querySelector("#map")),j=document.getElementById("canvas1"),k=j.getContext("2d");if(aa)e.src="data:image/svg+xml,"+i;else{let a=new Blob([i],{type:"image/svg+xml;charset=utf-8"}),c=b.createObjectURL(a);e.src=c}let l=32+5*conf.legendFactor,m="<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"2000\" height=\"150\"><text x=\"90\" y=\"50\" fill=\""+a+"\" font-size=\""+l+"\" font-weight=\"bold\" overflow=\"hidden\" font-family=\"Century Gothic,Segoe UI,Lucida Grande\">Created with "+T+" &#169; </text></svg>";if(aa)g.src="data:image/svg+xml,"+m;else{let a=new Blob([m],{type:"image/svg+xml;charset=utf-8"}),c=b.createObjectURL(a);g.src=c}e.onload=function(){k.fillStyle=$("#backgroundpicker").spectrum("get").toString(),k.fillRect(0,0,j.width,j.height),k.drawImage(e,0,0,j.width,j.height),X?(k.drawImage(f,conf.img2x,conf.img2y),k.drawImage(g,conf.img3x,conf.img3y+h)):k.drawImage(g,conf.img3x,conf.img3y);j.toDataURL("image/png");$(".loader-map").hide()},$("#canvas1, #map, #info").toggle(),$("#edit").prop("disabled",!1),$("#convert, #clear, #downup").prop("disabled",!0).css("color","#fff"),$("#download").toggle("slow")}function N(){for(let a,b=0;b<V.length;b++)a=V[b],$("#"+a).toggle()}function O(a,b){return a.match(RegExp(".{1,"+b+"}(\\s|$)","g"))}function P(){return U}function Q(){return!$.isEmptyObject(mapchart.colors())}const R=window.location.pathname.split("/"),S=R[R.length-1].split(".")[0],T=window.location.hostname.replace("www","");let U={},V=[],W=0,X=!0;const Y="#d1dbdd",Z=["world-1815","world-1880","world-1914","world-1938","world-cold-war","oceania-detailed","asia-detailed","africa-detailed","americas-detailed","detworld","usa-counties","russia","world","europe-detailed","usa-congressional-districts","canada-census-divisions","france-departments"];let _={};const aa=navigator.vendor&&-1<navigator.vendor.indexOf("Apple")&&navigator.userAgent&&-1==navigator.userAgent.indexOf("CriOS")&&-1==navigator.userAgent.indexOf("FxiOS");if(/iP(hone|od|ad)/.test(navigator.platform)){let a=document.getElementById("canvas1").width,b=document.getElementById("canvas1").height;document.getElementById("canvas1").width=a/2,document.getElementById("canvas1").height=b/2,conf.img2x/=2,conf.img2y/=2,conf.img3x=conf.img3x/2-40,conf.img3y/=2}let ba="js/normalizeIds.json?v='1.3'";R.includes("wamp")&&(ba="file://C:/wamp/www/mapchart/"+ba);var ca;$.ajax({dataType:"json",url:ba,success:function(a){ca=a}});const da=[["f7fcfd","e5f5f9","ccece6","99d8c9","66c2a4","41ae76","238b45","006d2c","00441b"],["f7fcfd","e0ecf4","bfd3e6","9ebcda","8c96c6","8c6bb1","88419d","810f7c","4d004b"],["f7fcf0","e0f3db","ccebc5","a8ddb5","7bccc4","4eb3d3","2b8cbe","0868ac","084081"],["fff7ec","fee8c8","fdd49e","fdbb84","fc8d59","ef6548","d7301f","b30000","7f0000"],["fff7fb","ece7f2","d0d1e6","a6bddb","74a9cf","3690c0","0570b0","045a8d","023858"],["ffffe5","f7fcb9","d9f0a3","addd8e","78c679","41ab5d","238443","006837","004529"],["ffffcc","ffeda0","fed976","feb24c","fd8d3c","fc4e2a","e31a1c","bd0026","800026"],["ffffd9","edf8b1","c7e9b4","7fcdbb","41b6c4","1d91c0","225ea8","253494","081d58"],["ffffff","f0f0f0","d9d9d9","bdbdbd","969696","737373","525252","252525","000000"],["762a83","9970ab","c2a5cf","e7d4e8","f7f7f7","d9f0d3","a6dba0","5aae61","1b7837"],["b35806","e08214","fdb863","fee0b6","f7f7f7","d8daeb","b2abd2","8073ac","542788"],["8c510a","bf812d","dfc27d","f6e8c3","f5f5f5","c7eae5","80cdc1","35978f","01665e"],["b2182b","d6604d","f4a582","fddbc7","f7f7f7","d1e5f0","92c5de","4393c3","2166ac"],["d73027","f46d43","fdae61","fee090","ffffbf","e0f3f8","abd9e9","74add1","4575b4"],["a6cee3","1f78b4","b2df8a","33a02c","fb9a99","e31c2c","fdbf6f","ff7f00","cab2d6"],["fbb4ae","e41a1c","377eb8","4daf4a","984ea3","ff2000","ffff33","a65628","999999"],["8dd3c7","ffffb3","bebada","fb8072","80b1d3","fdb462","b3de69","fccde5","ffa07a"],["b15928","6a3d9a","ffed6f","9e0142","5e4fa2","ffffbf","1a9850","4d4d4d","6baed6"],["71c671","388e8e","7d9ec0","7171c6","8e388e","8e8e38","00c957","cc3333","d1dbdd"]],ea=["<pattern id=\"circles3\" width=\"10\" height=\"10\" patternUnits=\"userSpaceOnUse\">    <rect width=\"10\" height=\"10\" fill=\"#fff\" />    <circle cx=\"4\" cy=\"4\" r=\"2\" fill=\"#000\"/>    </pattern>","<pattern id=\"diagonal1\" width=\"10\" height=\"10\" patternUnits=\"userSpaceOnUse\">    <rect width=\"10\" height=\"10\" fill=\"#fff\"/>    <path d=\"M-1,1 l2,-2 M0,10 l10,-10 M9,11 l2,-2\" stroke=\"#000\" stroke-width=\"1\"/>    </pattern>","<pattern id=\"diagonal3\" width=\"10\" height=\"10\" patternUnits=\"userSpaceOnUse\">    <rect width=\"10\" height=\"10\" fill=\"#fff\"/>    <path d=\"M-1,1 l2,-2 M0,10 l10,-10 M9,11 l2,-2\" stroke=\"#000\" stroke-width=\"3\"/>    </pattern>","<pattern id=\"vertical1\" width=\"10\" height=\"10\" patternUnits=\"userSpaceOnUse\">    <rect width=\"10\" height=\"10\" fill=\"#fff\" />    <rect x=\"3\" y=\"0\" width=\"1\" height=\"10\" fill=\"#000\" />    </pattern>","<pattern id=\"vertical3\" width=\"10\" height=\"10\" patternUnits=\"userSpaceOnUse\">    <rect width=\"10\" height=\"10\" fill=\"#fff\" />    <rect x=\"3\" y=\"0\" width=\"3\" height=\"10\" fill=\"#000\" />    </pattern>","<pattern id=\"horizontal1\" width=\"10\" height=\"10\" patternUnits=\"userSpaceOnUse\">    <rect width=\"10\" height=\"10\" fill=\"#fff\" />    <rect x=\"0\" y=\"4\" width=\"10\" height=\"1\" fill=\"#000\" />    </pattern>","<pattern id=\"horizontal3\" width=\"10\" height=\"10\" patternUnits=\"userSpaceOnUse\">    <rect width=\"10\" height=\"10\" fill=\"#fff\" />    <rect x=\"0\" y=\"4\" width=\"10\" height=\"3\" fill=\"#000\" />    </pattern>","<pattern id=\"crosshatch\" width=\"8\" height=\"8\" patternUnits=\"userSpaceOnUse\">    <rect width=\"8\" height=\"8\" fill=\"#fff\"/>    <path d=\"M0 0L8 8ZM8 0L0 8Z\" stroke-width=\"0.5\" stroke=\"#aaa\"/>    </pattern>","<pattern id=\"subtlepatch\" width=\"5\" height=\"5\" patternUnits=\"userSpaceOnUse\">    <rect width=\"5\" height=\"5\" fill=\"#fff\" />    <rect x=\"2\" y=\"2\" width=\"1\" height=\"1\" fill=\"#000\" />    </pattern>","<pattern id=\"checkers\" width=\"8\" height=\"8\" patternUnits=\"userSpaceOnUse\">    <rect width=\"8\" height=\"8\" fill=\"#fff\"/>    <path fill=\"#000\" fill-rule=\"evenodd\" d=\"M0 0h4v4H0V0zm4 4h4v4H4V4z\"/>    </pattern>","<pattern id=\"raindrops\" width=\"10\" height=\"10\" patternUnits=\"userSpaceOnUse\">    <rect width=\"10\" height=\"10\" fill=\"#fff\"/>    <path fill=\"#000\" d=\"M0 38.59l2.83-2.83 1.41 1.41L1.41 40H0v-1.41zM0 1.4l2.83 2.83 1.41-1.41L1.41 0H0v1.41zM38.59 40l-2.83-2.83 1.41-1.41L40 38.59V40h-1.41zM40 1.41l-2.83 2.83-1.41-1.41L38.59 0H40v1.41zM20 18.6l2.83-2.83 1.41 1.41L21.41 20l2.83 2.83-1.41 1.41L20 21.41l-2.83 2.83-1.41-1.41L18.59 20l-2.83-2.83 1.41-1.41L20 18.59z\"/>    </pattern>","<pattern id=\"texture\" width=\"4\" height=\"4\" patternUnits=\"userSpaceOnUse\">    <rect width=\"4\" height=\"4\" fill=\"#fff\"/>    <path fill=\"#000\" d=\"M1 3h1v1H1V3zm2-2h1v1H3V1z\"></path>    </pattern>"];return $(window).on("load",function(){$(".loader").fadeOut("very slow")}),jQuery.fn.outerHTML=function(){return jQuery("<div />").append(this.eq(0).clone()).html()},$(document).ready(function(){a()}),{click:n,removeColor:y,deleteRow:C,restoreConfig:G,convert:M,colors:P,verifyPath:u}}();